<div class="page-container">
  <header class="page-header">
    <h1>Sistema de Ligas Barriales</h1>
    <div class="user-info" *ngIf="user$ | async as user">
      <span>{{ user.nombre }}</span>
      <span class="user-role">({{ user.rol.nombre }})</span>
      <button class="btn-logout" (click)="logout()">Cerrar Sesi√≥n</button>
    </div>
  </header>

  <app-main-nav></app-main-nav>

  <div class="form-container">
  <div class="form-header">
    <h2>{{ isEditMode ? 'Editar Liga' : 'Nueva Liga' }}</h2>
  </div>

  <form [formGroup]="ligaForm" (ngSubmit)="onSubmit()" class="liga-form">
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div class="form-group">
      <label for="nombre">Nombre de la Liga *</label>
      <input
        type="text"
        id="nombre"
        formControlName="nombre"
        placeholder="Ej: Liga Barrial Norte"
        [class.error]="hasError('nombre', 'required') || hasError('nombre', 'maxlength')"
      />
      <span *ngIf="getErrorMessage('nombre')" class="field-error">
        {{ getErrorMessage('nombre') }}
      </span>
    </div>

    <div class="form-group">
      <label for="ubicacion">Ubicaci√≥n *</label>
      <input
        type="text"
        id="ubicacion"
        formControlName="ubicacion"
        placeholder="Ej: Quito, Barrio La Carolina"
        [class.error]="hasError('ubicacion', 'required') || hasError('ubicacion', 'maxlength')"
      />
      <span *ngIf="getErrorMessage('ubicacion')" class="field-error">
        {{ getErrorMessage('ubicacion') }}
      </span>
    </div>

    <div class="form-group">
      <label for="fechaFundacion">Fecha de Fundaci√≥n *</label>
      <input
        type="date"
        id="fechaFundacion"
        formControlName="fechaFundacion"
        [class.error]="hasError('fechaFundacion', 'required')"
      />
      <span *ngIf="getErrorMessage('fechaFundacion')" class="field-error">
        {{ getErrorMessage('fechaFundacion') }}
      </span>
    </div>

    <div class="form-group">
      <label for="directivoId">Directivo de la Liga (opcional)</label>
      <select
        id="directivoId"
        formControlName="directivoId"
      >
        <option value="">Sin directivo asignado</option>
        <option *ngFor="let directivo of directivos" [value]="directivo.id">
          {{ directivo.nombre }}
        </option>
      </select>
      <small class="help-text">
        üí° Puedes crear la liga sin directivo y asignarlo despu√©s editando la liga.
      </small>
    </div>

    <div class="form-group">
      <div *ngIf="!isEditMode" class="info-message">
        ‚ÑπÔ∏è Primero guarda la liga. Luego podr√°s editarla para agregar el logo.
      </div>
      <app-image-upload 
        *ngIf="isEditMode"
        [tipo]="'liga'"
        [ligaId]="ligaId || undefined"
        [currentImageUrl]="ligaForm.get('imagen')?.value"
        [label]="'Logo de la Liga'"
        (imageUploaded)="onImageUploaded($event)"
        (uploadError)="onImageUploadError($event)"
      ></app-image-upload>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="cancel()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn-primary" [disabled]="loading">
        {{ loading ? 'Guardando...' : (isEditMode ? 'Actualizar' : 'Crear Liga') }}
      </button>
    </div>
  </form>
</div>
</div>
