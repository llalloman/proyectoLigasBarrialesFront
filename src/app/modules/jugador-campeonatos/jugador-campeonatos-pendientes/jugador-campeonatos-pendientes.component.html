<div class="page-container">
  <header class="page-header">
    <h1>Sistema de Ligas Barriales</h1>
    <div class="user-info" *ngIf="user$ | async as user">
      <span>{{ user.nombre }}</span>
      <span class="user-role">({{ user.rol.nombre }})</span>
      <button class="btn-logout" (click)="logout()">Cerrar SesiÃ³n</button>
    </div>
  </header>

  <app-main-nav></app-main-nav>

  <div class="page-title">
    <h2>â³ Habilitaciones Pendientes</h2>
    <div class="header-actions">
      <button
        type="button"
        class="btn btn-secondary"
        routerLink="/jugador-campeonatos"
      >
        â† Volver
      </button>
    </div>
  </div>

  <div class="alert alert-success" *ngIf="successMessage">
    {{ successMessage }}
  </div>

  <div class="alert alert-error" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <!-- Barra de bÃºsqueda -->
  <div class="search-container" *ngIf="!loading && habilitaciones.length > 0">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input 
        type="text" 
        class="search-input" 
        placeholder="Buscar por nombre o cÃ©dula del jugador..."
        [(ngModel)]="searchTerm"
        (input)="onSearchChange($any($event.target).value)"
      />
      <button 
        *ngIf="searchTerm" 
        class="clear-btn" 
        (click)="clearSearch()"
        title="Limpiar bÃºsqueda">
        âœ•
      </button>
    </div>
    <div class="search-results" *ngIf="searchTerm">
      <span>{{ filteredHabilitaciones.length }} de {{ habilitaciones.length }} habilitaciones pendientes</span>
    </div>
  </div>

  <div class="loading-spinner" *ngIf="loading">
    <p>Cargando...</p>
  </div>

  <div class="empty-state" *ngIf="!loading && habilitaciones.length === 0">
    <p>âœ… No hay habilitaciones pendientes</p>
  </div>

  <div class="cards-grid" *ngIf="!loading && habilitaciones.length > 0">
    <div class="card" *ngFor="let habilitacion of filteredHabilitaciones">
      <div class="card-header">
        <div class="player-info">
          <h3>{{ habilitacion.jugador?.nombreCompleto }}</h3>
          <p class="player-detail">#{{ habilitacion.numeroCancha }} - {{ habilitacion.posicion }}</p>
        </div>
        <span class="badge badge-pendiente">Pendiente</span>
      </div>

      <!-- SecciÃ³n de imÃ¡genes -->
      <div class="images-section">
        <div class="image-container">
          <label class="image-label">Foto del Jugador</label>
          <img
            *ngIf="habilitacion.jugador?.imagen"
            [src]="habilitacion.jugador.imagen"
            alt="Foto de {{ habilitacion.jugador.nombre }}"
            class="player-image"
          />
          <div class="player-photo-placeholder" *ngIf="!habilitacion.jugador?.imagen">
            ğŸ‘¤
          </div>
        </div>
        <div class="image-container">
          <label class="image-label">CÃ©dula</label>
          <img
            *ngIf="habilitacion.jugador?.imagenCedula"
            [src]="habilitacion.jugador.imagenCedula"
            alt="CÃ©dula de {{ habilitacion.jugador.nombre }}"
            class="cedula-image"
            (click)="openImageModal(habilitacion.jugador.imagenCedula)"
          />
          <div class="cedula-placeholder" *ngIf="!habilitacion.jugador?.imagenCedula">
            ğŸ“„
          </div>
        </div>
      </div>

      <div class="card-body">
        <div class="info-row">
          <span class="label">Equipo:</span>
          <span class="value">{{ habilitacion.equipo?.nombre }}</span>
        </div>
        <div class="info-row">
          <span class="label">CategorÃ­a:</span>
          <span class="value">{{ habilitacion.categoria?.nombre }}</span>
        </div>
        <div class="info-row">
          <span class="label">CÃ©dula:</span>
          <span class="value">{{ habilitacion.jugador?.cedula }}</span>
        </div>
        <div class="info-row">
          <span class="label">Campeonato:</span>
          <span class="value">{{ habilitacion.campeonato?.nombre }}</span>
        </div>
        <div class="info-row" *ngIf="habilitacion.observaciones">
          <span class="label">Observaciones:</span>
          <span class="value">{{ habilitacion.observaciones }}</span>
        </div>
        <div class="info-row">
          <span class="label">Solicitado:</span>
          <span class="value">{{ habilitacion.fechaInscripcion | date: 'short' }}</span>
        </div>
      </div>

      <div class="card-actions">
        <button
          type="button"
          class="btn-icon btn-success"
          (click)="aprobar(habilitacion.id)"
          title="Aprobar"
          *ngIf="permissions.canAprobarHabilitaciones()"
        >
          âœ…
        </button>
        <button
          type="button"
          class="btn-icon btn-danger"
          (click)="rechazar(habilitacion.id)"
          title="Rechazar"
          *ngIf="permissions.canAprobarHabilitaciones()"
        >
          âŒ
        </button>
      </div>
    </div>
  </div>

  <!-- Modal para ampliar imagen de cÃ©dula -->
  <div class="modal-overlay" *ngIf="showImageModal" (click)="closeImageModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="modal-close" (click)="closeImageModal()">âœ•</button>
      <img [src]="modalImageUrl" alt="CÃ©dula ampliada" class="modal-image">
    </div>
  </div>
</div>
